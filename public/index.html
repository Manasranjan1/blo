<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Donor - Login</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü©∏</text></svg>">
</head>
<body>
    <div class="container">
        <div class="auth-container">
            <div class="card auth-card">
                <div class="auth-logo">ü©∏</div>
                <h1 class="auth-title">Blood Donor</h1>
                <p class="auth-subtitle">Connect donors with those in need</p>
                
                <div id="phone-section">
                    <div class="form-group">
                        <label for="phone" class="form-label">Phone Number</label>
                        <div class="phone-input">
                            <select id="country-code" class="form-select">
                                <option value="+91">+91</option>
                                <option value="+1">+1</option>
                                <option value="+44">+44</option>
                                <option value="+61">+61</option>
                                <option value="+86">+86</option>
                            </select>
                            <input type="tel" id="phone" class="form-input" placeholder="Enter phone number" required>
                        </div>
                    </div>
                    
                    <div id="recaptcha-container"></div>
                    
                    <button id="send-otp-btn" class="btn btn-primary" style="width: 100%;">
                        Send OTP
                    </button>
                </div>
                
                <div id="otp-section" class="hidden">
                    <div class="form-group">
                        <label for="otp" class="form-label">Enter OTP</label>
                        <input type="text" id="otp" class="form-input" placeholder="Enter 6-digit OTP" maxlength="6" required>
                    </div>
                    
                    <button id="verify-otp-btn" class="btn btn-primary" style="width: 100%;">
                        Verify OTP
                    </button>
                    
                    <button id="back-to-phone" class="btn btn-outline" style="width: 100%; margin-top: 1rem;">
                        ‚Üê Back to Phone
                    </button>
                </div>
                
                <div id="alert-container"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging-compat.js"></script>
    
    <!-- App Scripts -->
    <script src="firebaseConfig.js"></script>
    <script src="geoFirestore.js"></script>
    <script src="auth.js"></script>
    <script src="requests.js"></script>
    <script src="notifications.js"></script>
    
    <script>
        // DOM elements
        const phoneSection = document.getElementById('phone-section');
        const otpSection = document.getElementById('otp-section');
        const sendOtpBtn = document.getElementById('send-otp-btn');
        const verifyOtpBtn = document.getElementById('verify-otp-btn');
        const backToPhoneBtn = document.getElementById('back-to-phone');
        const phoneInput = document.getElementById('phone');
        const otpInput = document.getElementById('otp');
        const countryCodeSelect = document.getElementById('country-code');
        const alertContainer = document.getElementById('alert-container');

        // Show alert message
        function showAlert(message, type = 'info') {
            alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Send OTP
        sendOtpBtn.addEventListener('click', async () => {
            const phone = phoneInput.value.trim();
            const countryCode = countryCodeSelect.value;
            
            if (!phone) {
                showAlert('Please enter a phone number', 'error');
                return;
            }
            
            if (phone.length < 10) {
                showAlert('Please enter a valid phone number', 'error');
                return;
            }

            const fullPhone = countryCode + phone;
            
            try {
                sendOtpBtn.disabled = true;
                sendOtpBtn.innerHTML = '<span class="loading"></span> Sending...';
                
                await window.authModule.sendOTP(fullPhone);
                showAlert('OTP sent successfully!', 'success');
                
            } catch (error) {
                console.error('Error sending OTP:', error);
                showAlert(error.message || 'Failed to send OTP. Please try again.', 'error');
            } finally {
                sendOtpBtn.disabled = false;
                sendOtpBtn.innerHTML = 'Send OTP';
            }
        });

        // Verify OTP
        verifyOtpBtn.addEventListener('click', async () => {
            const otp = otpInput.value.trim();
            
            if (!otp || otp.length !== 6) {
                showAlert('Please enter a valid 6-digit OTP', 'error');
                return;
            }

            try {
                verifyOtpBtn.disabled = true;
                verifyOtpBtn.innerHTML = '<span class="loading"></span> Verifying...';
                
                await window.authModule.verifyOTP(otp);
                showAlert('OTP verified successfully! Redirecting...', 'success');
                
                // User will be automatically redirected by auth state listener
                
            } catch (error) {
                console.error('Error verifying OTP:', error);
                showAlert(error.message || 'Failed to verify OTP. Please try again.', 'error');
            } finally {
                verifyOtpBtn.disabled = false;
                verifyOtpBtn.innerHTML = 'Verify OTP';
            }
        });

        // Back to phone input
        backToPhoneBtn.addEventListener('click', () => {
            phoneSection.style.display = 'block';
            otpSection.style.display = 'none';
            otpInput.value = '';
            alertContainer.innerHTML = '';
        });

        // Enter key handlers
        phoneInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendOtpBtn.click();
            }
        });

        otpInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                verifyOtpBtn.click();
            }
        });

        // Auto-focus phone input on page load
        window.addEventListener('load', () => {
            phoneInput.focus();
        });
    </script>
</body>
</html> 